<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            background-color: rgba(255, 255, 255, 0.95);
            color: #2c3e50;
            padding: 20px;
            text-align: center;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #1a2a6c;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #fdbb2d, #b21f1f);
        }
        
        .btn-large {
            padding: 15px 30px;
            font-size: 1.2rem;
        }
        
        .btn-full {
            width: 100%;
            margin-top: 15px;
        }
        
        .lobby-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .code-display {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: 3px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            border-color: #1a2a6c;
            outline: none;
        }
        
        .players-list {
            margin: 20px 0;
        }
        
        .player {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #1a2a6c;
        }
        
        .player-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .timer {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .question-container {
            margin-bottom: 20px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .question-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 600;
            color: #2c3e50;
            line-height: 1.5;
        }
        
        .answers {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .answer-option {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .answer-option:hover {
            border-color: #1a2a6c;
            background-color: #f8f9fa;
        }
        
        .answer-option.selected {
            border-color: #1a2a6c;
            background-color: #e8f4fd;
        }
        
        .answer-letter {
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #1a2a6c;
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
            font-weight: bold;
        }
        
        .friend-choice {
            margin-left: auto;
            color: #e74c3c;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .friend-choice::before {
            content: "üë§";
            margin-right: 5px;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }
        
        .progress {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .progress-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #e0e0e0;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .progress-dot.answered {
            background-color: #1a2a6c;
        }
        
        .progress-dot.current {
            background-color: #fdbb2d;
            transform: scale(1.2);
        }
        
        .results-container {
            text-align: center;
        }
        
        .results-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #2c3e50;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            font-size: 1.1rem;
        }
        
        .result-name {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .result-score {
            color: #27ae60;
            font-weight: bold;
        }
        
        .status-message {
            padding: 10px 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
        }
        
        .status-waiting {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-success {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .connection-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #e74c3c;
        }
        
        .connection-dot.connected {
            background-color: #2ecc71;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .lobby-actions {
                flex-direction: column;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-car-side"></i> –¢–µ—Å—Ç –º—è—É –î–∞—à–∞</h1>
            <p class="subtitle">–ù—É –º—è—É</p>
        </header>
        
        <div id="mainMenu" class="screen active card">
            <h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</p>
            <div class="lobby-actions">
                <button id="createLobbyBtn" class="btn btn-large">–°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏</button>
                <button id="joinLobbyBtn" class="btn btn-large btn-secondary">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –ª–æ–±–±–∏</button>
            </div>
        </div>
        
        <div id="createLobbyScreen" class="screen card">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–±–±–∏</h2>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –ª–æ–±–±–∏ –∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞</p>
            
            <div class="input-group">
                <label for="playerName">–í–∞—à–µ –∏–º—è:</label>
                <input type="text" id="playerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" value="–ò–≥—Ä–æ–∫ 1">
            </div>
            
            <div class="code-display" id="lobbyCodeDisplay">A1B2C3</div>
            
            <div class="connection-status">
                <div class="connection-dot" id="connectionDot"></div>
                <span id="connectionStatus">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</span>
            </div>
            
            <div class="players-list">
                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</h3>
                <div class="player">
                    <div class="player-icon">1</div>
                    <div class="player-name" id="hostPlayerName">–ò–≥—Ä–æ–∫ 1 (–í—ã)</div>
                </div>
                <div id="player2" class="player" style="display: none;">
                    <div class="player-icon">2</div>
                    <div class="player-name" id="player2Name">–ò–≥—Ä–æ–∫ 2</div>
                </div>
            </div>
            
            <div class="status-message status-waiting" id="waitingMessage">
                –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...
            </div>
            
            <button id="startGameBtn" class="btn btn-full" disabled>–ù–∞—á–∞—Ç—å —ç–∫–∑–∞–º–µ–Ω</button>
            <button id="backToMenuBtn1" class="btn btn-full btn-secondary">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
        </div>
        
        <div id="joinLobbyScreen" class="screen card">
            <h2>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –ª–æ–±–±–∏</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ª–æ–±–±–∏, —á—Ç–æ–±—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –¥—Ä—É–≥—É</p>
            
            <div class="input-group">
                <label for="joinPlayerName">–í–∞—à–µ –∏–º—è:</label>
                <input type="text" id="joinPlayerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" value="–ò–≥—Ä–æ–∫ 2">
            </div>
            
            <div class="input-group">
                <label for="lobbyCodeInput">–ö–æ–¥ –ª–æ–±–±–∏:</label>
                <input type="text" id="lobbyCodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ª–æ–±–±–∏" maxlength="6">
            </div>
            
            <div class="connection-status">
                <div class="connection-dot" id="joinConnectionDot"></div>
                <span id="joinConnectionStatus">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
            </div>
            
            <button id="joinLobbyConfirmBtn" class="btn btn-full">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            <button id="backToMenuBtn2" class="btn btn-full btn-secondary">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
        </div>
        
        <div id="examScreen" class="screen card">
            <div class="timer" id="timer">30:00</div>
            
            <div class="question-header">
                <div>–í–æ–ø—Ä–æ—Å <span id="currentQuestion">1</span> –∏–∑ <span id="totalQuestions">20</span></div>
                <div>–°–æ–ø–µ—Ä–Ω–∏–∫: <span id="opponentStatus">–û–∂–∏–¥–∞–Ω–∏–µ...</span></div>
            </div>
            
            <div class="question-container">
                <img id="questionImage" src="" alt="–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –∫ –≤–æ–ø—Ä–æ—Å—É" class="question-image">
                <div class="question-text" id="questionText">–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</div>
                
                <div class="answers" id="answersContainer">
                </div>
                
                <div class="navigation">
                    <button id="prevQuestion" class="btn" disabled>–ù–∞–∑–∞–¥</button>
                    <button id="nextQuestion" class="btn">–î–∞–ª–µ–µ</button>
                </div>
                
                <div class="progress" id="progressContainer">
                </div>
            </div>
        </div>
        
        <div id="resultsScreen" class="screen card results-container">
            <h2 class="results-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫–∑–∞–º–µ–Ω–∞</h2>
            
            <div class="result-item">
                <span class="result-name" id="userResultName">–í—ã:</span>
                <span class="result-score" id="userScore">0/20</span>
            </div>
            <div class="result-item">
                <span class="result-name" id="opponentResultName">–°–æ–ø–µ—Ä–Ω–∏–∫:</span>
                <span class="result-score" id="opponentScore">0/20</span>
            </div>
            
            <div class="result-item" style="border-bottom: none; margin-top: 20px; font-size: 1.3rem; justify-content: center;">
                <span id="winnerText">–ù–∏—á—å—è!</span>
            </div>
            
            <button id="restartExamBtn" class="btn btn-full">–ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞</button>
            <button id="backToMenuBtn3" class="btn btn-full btn-secondary">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
    </div>

    <script>

        const questions = [
            {
                id: 1,
                text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ª–∏ –í–∞–º –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞ –∑–Ω–∞–∫–æ–º?",
                image: "1.jpg",
                answers: [
                    { id: 'a', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è." },
                    { id: 'b', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏ (–≤—ã—Å–∞–¥–∫–∏) –ø–∞—Å—Å–∞–∂–∏—Ä–∞." },
                    { id: 'c', text: "–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è." }
                ], correctAnswer: 'c'
            },
            {
                id: 2,
                text: "–ö–∞–∫–∏–µ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ –æ–±—è–∑—ã–≤–∞—é—Ç –≤–æ–¥–∏—Ç–µ–ª—è –≥—Ä—É–∑–æ–≤–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –º–∞—Å—Å–æ–π –Ω–µ –±–æ–ª–µ–µ 3,5 —Ç –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞–ø—Ä–∞–≤–æ?",
                image: "2.jpg",
                answers: [
                    { id: 'a', text: "–¢–æ–ª—å–∫–æ –ê." },
                    { id: 'b', text: "–¢–æ–ª—å–∫–æ –ë." },
                    { id: 'c', text: "–ê –∏ –ë." },
                    { id: 'd', text: "–ë –∏ –í." }
                ],
                correctAnswer: 'b'
            },
            {
                id: 3,
                text: "–ö–∞–∫–∏–µ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥ –∂–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–º –ø–µ—Ä–µ–µ–∑–¥–æ–º?",
                image: "3.jpg",
                answers: [
                    { id: 'a', text: "–¢–æ–ª—å–∫–æ –ê." },
                    { id: 'b', text: "–¢–æ–ª—å–∫–æ –ë." },
                    { id: 'c', text: "–¢–æ–ª—å–∫–æ –í." },
                    { id: 'd', text: "–ê –∏ –í." }
                ],
                correctAnswer: 'c'
            },
            {
                id: 4,
                text: "–†–∞–∑—Ä–µ—à–µ–Ω–æ –ª–∏ –í–∞–º –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –º–µ—Å—Ç–µ?",
                image: "4.jpg",
                answers: [
                    { id: 'a', text: "–ó–∞–ø—Ä–µ—â–µ–Ω–æ." },
                    { id: 'b', text: "–†–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏ –∏–ª–∏ –≤—ã—Å–∞–¥–∫–∏ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤." },
                    { id: 'c', text: "–†–∞–∑—Ä–µ—à–µ–Ω–æ." }
                ],
                correctAnswer: 'a'
            },
            {
                id: 5,
                text: "–°–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –ø—Ä–æ–µ–∑–∂–∏—Ö —á–∞—Å—Ç–µ–π –∏–º–µ–µ—Ç —ç—Ç–æ—Ç –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–æ–∫?",
                image: "5.jpg",
                answers: [
                    { id: 'a', text: "–û–¥–Ω–æ." },
                    { id: 'b', text: "–î–≤–∞." },
                    { id: 'c', text: "–ß–µ—Ç—ã—Ä–µ." }
                ],
                correctAnswer: 'b'
            },
            {
                id: 6,
                text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ª–∏ –≤–æ–¥–∏—Ç–µ–ª—é –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –≤–æ –≤—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è?",
                image: "#",
                answers: [
                    { id: 'a', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –ø–æ–∑–≤–æ–ª—è—é—â–µ–≥–æ –≤–µ—Å—Ç–∏ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä—É–∫." },
                    { id: 'b', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è." },
                    { id: 'c', text: "–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è." }
                ],
                correctAnswer: 'a'
            },
            {
                id: 7,
                text: "–í—ã –Ω–∞–º–µ—Ä–µ–Ω—ã –ø—Ä–æ–µ—Ö–∞—Ç—å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–æ–∫ –≤ –ø—Ä—è–º–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?",
                image: "7.webp",
                answers: [
                    { id: 'a', text: "–ü—Ä–æ–µ–¥–µ—Ç–µ –ø–µ—Ä–≤—ã–º, —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É—è—Å—å —Å–∏–≥–Ω–∞–ª–æ–º —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞" },
                    { id: 'b', text: "–ü—Ä–æ–µ–¥–µ—Ç–µ –ø–µ—Ä–≤—ã–º, —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É—è—Å—å –∑–Ω–∞–∫–æ–º ¬´–ì–ª–∞–≤–Ω–∞—è –¥–æ—Ä–æ–≥–∞¬ª" },
                    { id: 'c', text: "–£—Å—Ç—É–ø–∏—Ç–µ –¥–æ—Ä–æ–≥—É —Ç—Ä–∞–º–≤–∞—é" }
                ],
                correctAnswer: 'c'
            },
            {
                id: 8,
                text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ª–∏ –±—É–∫—Å–∏—Ä–æ–≤–∫–∞ –≤ –≥–æ–ª–æ–ª–µ–¥–∏—Ü—É, –µ—Å–ª–∏ —É –±—É–∫—Å–∏—Ä—É–µ–º–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–Ω—ã —Ç–æ—Ä–º–æ–∑–∞ –∏ —Ä—É–ª–µ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?",
                image: "#",
                answers: [
                    { id: 'a', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è." },
                    { id: 'b', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∂—ë—Å—Ç–∫–æ–π —Å—Ü–µ–ø–∫–µ –∏–ª–∏ –º–µ—Ç–æ–¥–æ–º —á–∞—Å—Ç–∏—á–Ω–æ–π –ø–æ–≥—Ä—É–∑–∫–∏" },
                    { id: 'c', text: "–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è" } ],
                correctAnswer: 'b'
            },
            {
                id: 9,
                text: "–ü—Ä–∏ —Å—ä–µ–∑–¥–µ —Å –¥–æ—Ä–æ–≥–∏ –Ω–∞ –ø—Ä–∏–ª–µ–≥–∞—é—â—É—é —Å–ø—Ä–∞–≤–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –í—ã:",
                image: "9.jpg",
                answers: [
                    { id: 'a', text: "–ü–æ–ª—å–∑—É–µ—Ç–µ—Å—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –¥–≤–∏–∂–µ–Ω–∏—è." },
                    { id: 'b', text: "–î–æ–ª–∂–Ω—ã —É—Å—Ç—É–ø–∏—Ç—å –¥–æ—Ä–æ–≥—É —Ç–æ–ª—å–∫–æ –ø–µ—à–µ—Ö–æ–¥–∞–º." },
                    { id: 'c', text: "–î–æ–ª–∂–Ω—ã —É—Å—Ç—É–ø–∏—Ç—å –¥–æ—Ä–æ–≥—É —Ç–æ–ª—å–∫–æ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∏—Å—Ç—É." },
                    { id: 'd', text: "–î–æ–ª–∂–Ω—ã —É—Å—Ç—É–ø–∏—Ç—å –¥–æ—Ä–æ–≥—É –ø–µ—à–µ—Ö–æ–¥–∞–º –∏ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∏—Å—Ç—É." }
                ],
                correctAnswer: 'd'
            },
            {
                id: 10,
                text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –∑–∞–¥–Ω–∏–º —Ö–æ–¥–æ–º –Ω–∞ –∞–≤—Ç–æ–º–∞–≥–∏—Å—Ç—Ä–∞–ª–∏?",
                image: "#",
                answers: [
                    { id: 'a', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è" },
                    { id: 'b', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è, –µ—Å–ª–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–∞–≤–µ–µ —Å–ø–ª–æ—à–Ω–æ–π –ª–∏–Ω–∏–∏ —Ä–∞–∑–º–µ—Ç–∫–∏, –æ–±–æ–∑–Ω–∞—á–∞—é—â–µ–π –∫—Ä–∞–π –ø—Ä–æ–µ–∑–∂–µ–π —á–∞—Å—Ç–∏ –∞–≤—Ç–æ–º–∞–≥–∏—Å—Ç—Ä–∞–ª–∏" },
                    { id: 'c', text: "–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è" }
                ],
                correctAnswer: 'c'
            },
            {
                id: 11,
                text: "–°–ø–æ—Å–æ–± —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–ª–µ–≥–∞—é—â–µ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ —Å–ª–µ–≤–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è, –ø–æ–∫–∞–∑–∞–Ω:",
                image: "11.jpg",
                answers: [
                    { id: 'a', text: "–¢–æ–ª—å–∫–æ –Ω–∞ –ª–µ–≤–æ–º —Ä–∏—Å—É–Ω–∫–µ" },
                    { id: 'b', text: "–¢–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–∞–≤–æ–º —Ä–∏—Å—É–Ω–∫–µ" },
                    { id: 'c', text: "–ù–∞ –æ–±–æ–∏—Ö —Ä–∏—Å—É–Ω–∫–∞—Ö" }
                ],
                correctAnswer: 'b'
            },
            {
                id: 12,
                text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ª–∏ –í–∞–º –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –º–µ—Å—Ç–µ?",
                image: "12.jpg",
                answers: [
                    { id: 'a', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è." },
                    { id: 'b', text: "–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–µ –±–ª–∏–∂–µ 5 –º –æ—Ç –∫—Ä–∞—è –ø–µ—Ä–µ—Å–µ–∫–∞–µ–º–æ–π –ø—Ä–æ–µ–∑–∂–µ–π —á–∞—Å—Ç–∏." },
                    { id: 'c', text: "–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è." }
                ],
                correctAnswer: 'b'
            },
            {
                id: 13,
                text: "–ö–∞–∫ –í–∞–º —Å–ª–µ–¥—É–µ—Ç –ø–æ—Å—Ç—É–ø–∏—Ç—å –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞?",
                image: "13.jpg",
                answers: [
                    { id: 'a', text: "–ü—Ä–æ–µ—Ö–∞—Ç—å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–æ–∫ –ø–µ—Ä–≤—ã–º." },
                    { id: 'b', text: "–£—Å—Ç—É–ø–∏—Ç—å –¥–æ—Ä–æ–≥—É —Ç–æ–ª—å–∫–æ –ª–µ–≥–∫–æ–≤–æ–º—É –∞–≤—Ç–æ–º–æ–±–∏–ª—é." },
                    { id: 'c', text: "–£—Å—Ç—É–ø–∏—Ç—å –¥–æ—Ä–æ–≥—É –æ–±–æ–∏–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–∞–º." }
                ],
                correctAnswer: 'b'
            },
            {
                id: 14,
                text: "–° –∫–∞–∫–æ–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞ –ª–µ–≥–∫–æ–≤–æ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ?",
                image: "14.webp",
                answers: [
                    { id: 'a', text: "70 –∫–º/—á." },
                    { id: 'b', text: "90 –∫–º/—á." },
                    { id: 'c', text: "110 –∫–º/—á." }
                ],
                correctAnswer: 'c'
            },
            {
                id: 15,
                text: "–ú–æ–∂–Ω–æ –ª–∏ –í–∞–º –ø–æ—Å–ª–µ –æ–ø–µ—Ä–µ–∂–µ–Ω–∏—è –≥—Ä—É–∑–æ–≤–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ –ª–µ–≤–æ–π –ø–æ–ª–æ—Å–µ –≤–Ω–µ –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤?",
                image: "15.jpg",
                answers: [
                    { id: 'a', text: "–ú–æ–∂–Ω–æ." },
                    { id: 'b', text: "–ú–æ–∂–Ω–æ –µ—Å–ª–∏ –≤—ã —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ –ª–µ–≥–∫–æ–≤—ã–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º" },
                    { id: 'c', text: "–ù–µ–ª—å–∑—è." }
                ],
                correctAnswer: 'c'
            },
            {
                id: 16,
                text: "–ß—Ç–æ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—å –≤–æ–¥–∏—Ç–µ–ª—é –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ–ø–∞—Å–Ω—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –∑–∞–Ω–æ—Å–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –ø—Ä–∏ —Ä–µ–∑–∫–æ–º –ø–æ–≤–æ—Ä–æ—Ç–µ —Ä—É–ª–µ–≤–æ–≥–æ –∫–æ–ª–µ—Å–∞ –Ω–∞ —Å–∫–æ–ª—å–∑–∫–æ–π –¥–æ—Ä–æ–≥–µ?",
                image: "#",
                answers: [
                    { id: 'a', text: "–ë—ã—Å—Ç—Ä–æ, –Ω–æ –ø–ª–∞–≤–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç—å —Ä—É–ª–µ–≤–æ–µ –∫–æ–ª–µ—Å–æ –≤ —Å—Ç–æ—Ä–æ–Ω—É –∑–∞–Ω–æ—Å–∞, –∑–∞—Ç–µ–º –æ–ø–µ—Ä–µ–∂–∞—é—â–∏–º –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º –Ω–∞ —Ä—É–ª–µ–≤–æ–µ –∫–æ–ª–µ—Å–æ –≤—ã—Ä–æ–≤–Ω—è—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é –¥–≤–∏–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è." },
                    { id: 'b', text: "–í—ã–∫–ª—é—á–∏—Ç—å —Å—Ü–µ–ø–ª–µ–Ω–∏–µ –∏ –ø–æ–≤–µ—Ä–Ω—É—Ç—å —Ä—É–ª–µ–≤–æ–µ –∫–æ–ª–µ—Å–æ –≤ —Å—Ç–æ—Ä–æ–Ω—É –∑–∞–Ω–æ—Å–∞" },
                    { id: 'c', text: "–ù–∞–∂–∞—Ç—å –Ω–∞ –ø–µ–¥–∞–ª—å —Ç–æ—Ä–º–æ–∑–∞ –∏ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º –Ω–∞ —Ä—É–ª–µ–≤–æ–µ –∫–æ–ª–µ—Å–æ –≤—ã—Ä–æ–≤–Ω—è—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é –¥–≤–∏–∂–µ–Ω–∏—è." }
                ],
                correctAnswer: 'a'
            },
            {
                id: 17,
                text: "–ü—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –≤ —Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –Ω–∞ –Ω–µ–æ—Å–≤–µ—â–µ–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–∫–∞—Ö –¥–æ—Ä–æ–≥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ç—É–º–∞–Ω–Ω—ã–µ —Ñ–∞—Ä—ã:",
                image: "#",
                answers: [
                    { id: 'a', text: "–¢–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –±–ª–∏–∂–Ω–µ–≥–æ –∏–ª–∏ –¥–∞–ª—å–Ω–µ–≥–æ —Å–≤–µ—Ç–∞ —Ñ–∞—Ä." },
                    { id: 'b', text: "–¢–æ–ª—å–∫–æ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –±–ª–∏–∂–Ω–∏–º –∏–ª–∏ –¥–∞–ª—å–Ω–∏–º —Å–≤–µ—Ç–æ–º —Ñ–∞—Ä." },
                    { id: 'c', text: "–ö–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ, —Ç–∞–∫ –∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –±–ª–∏–∂–Ω–∏–º –∏–ª–∏ –¥–∞–ª—å–Ω–∏–º —Å–≤–µ—Ç–æ–º —Ñ–∞—Ä." }
                ],
                correctAnswer: 'b'
            },
            {
                id: 18,
                text: "–í —Ç–æ–Ω–Ω–µ–ª–µ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã:",
                image: "#",
                answers: [
                    { id: 'a', text: "–§–∞—Ä—ã –±–ª–∏–∂–Ω–µ–≥–æ —Å–≤–µ—Ç–∞ –∏–ª–∏ –≥–∞–±–∞—Ä–∏—Ç–Ω—ã–µ –æ–≥–Ω–∏." },
                    { id: 'b', text: "–§–∞—Ä—ã –±–ª–∏–∂–Ω–µ–≥–æ —Å–≤–µ—Ç–∞ –∏–ª–∏ –¥–Ω–µ–≤–Ω—ã–µ —Ö–æ–¥–æ–≤—ã–µ –æ–≥–Ω–∏." },
                    { id: 'c', text: "–§–∞—Ä—ã –±–ª–∏–∂–Ω–µ–≥–æ –∏–ª–∏ –¥–∞–ª—å–Ω–µ–≥–æ —Å–≤–µ—Ç–∞." }
                ],
                correctAnswer: '—Å'
            },
            {
                id: 19,
                text: "–ü—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –ø–æ –∫–∞–∫–æ–º—É —É—á–∞—Å—Ç–∫—É –¥–æ—Ä–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–µ —Å–∏–ª—å–Ω–æ–≥–æ –±–æ–∫–æ–≤–æ–≥–æ –≤–µ—Ç—Ä–∞ –Ω–∞–∏–±–æ–ª–µ–µ –æ–ø–∞—Å–Ω–æ?",
                image: "#",
                answers: [
                    { id: 'a', text: "–ü–æ –∑–∞–∫—Ä—ã—Ç–æ–º—É –¥–µ—Ä–µ–≤—å—è–º–∏." },
                    { id: 'b', text: "–ü—Ä–∏ –≤—ã–µ–∑–¥–µ —Å –∑–∞–∫—Ä—ã—Ç–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–π." },
                    { id: 'c', text: "–ü–æ –æ—Ç–∫—Ä—ã—Ç–æ–º—É." }
                ],
                correctAnswer: 'b'
            },
            {
                id: 20,
                text: "–≠—Ç–∏ –∑–Ω–∞–∫–∏ –æ–±—è–∑—ã–≤–∞—é—Ç —Å–æ–±–ª—é–¥–∞—Ç—å –¥–∏—Å—Ç–∞–Ω—Ü–∏—é:",
                image: "20.jpg",
                answers: [
                    { id: 'a', text: "–ú–µ–Ω–µ–µ 70 –º –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ 100 –º." },
                    { id: 'b', text: "–ù–µ –º–µ–Ω–µ–µ 70 –º –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ 100 –º." },
                    { id: 'c', text: "–û—Ç 70 –º –¥–æ 100 –º." }
                ],
                correctAnswer: 'b'
            }
        ];

        const state = {
            currentQuestionIndex: 0,
            userAnswers: new Array(questions.length).fill(null),
            opponentAnswers: new Array(questions.length).fill(null),
            timeLeft: 30 * 60,
            timerInterval: null,
            examStarted: false,
            isHost: false,
            lobbyCode: '',
            playerName: '',
            opponentName: '',
            connectionStatus: 'disconnected',
            peer: null,
            conn: null,
            peerId: null
        };

        const screens = {
            mainMenu: document.getElementById('mainMenu'),
            createLobby: document.getElementById('createLobbyScreen'),
            joinLobby: document.getElementById('joinLobbyScreen'),
            exam: document.getElementById('examScreen'),
            results: document.getElementById('resultsScreen')
        };

        const createLobbyBtn = document.getElementById('createLobbyBtn');
        const joinLobbyBtn = document.getElementById('joinLobbyBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const backToMenuBtn1 = document.getElementById('backToMenuBtn1');
        const backToMenuBtn2 = document.getElementById('backToMenuBtn2');
        const backToMenuBtn3 = document.getElementById('backToMenuBtn3');
        const joinLobbyConfirmBtn = document.getElementById('joinLobbyConfirmBtn');
        const restartExamBtn = document.getElementById('restartExamBtn');
        
        const playerNameInput = document.getElementById('playerName');
        const joinPlayerNameInput = document.getElementById('joinPlayerName');
        const lobbyCodeInput = document.getElementById('lobbyCodeInput');
        const lobbyCodeDisplay = document.getElementById('lobbyCodeDisplay');
        const hostPlayerName = document.getElementById('hostPlayerName');
        
        const connectionDot = document.getElementById('connectionDot');
        const connectionStatus = document.getElementById('connectionStatus');
        const joinConnectionDot = document.getElementById('joinConnectionDot');
        const joinConnectionStatus = document.getElementById('joinConnectionStatus');
        
        const player2Element = document.getElementById('player2');
        const player2NameElement = document.getElementById('player2Name');
        const waitingMessage = document.getElementById('waitingMessage');
        
        const timerElement = document.getElementById('timer');
        const currentQuestionElement = document.getElementById('currentQuestion');
        const totalQuestionsElement = document.getElementById('totalQuestions');
        const opponentStatusElement = document.getElementById('opponentStatus');
        const questionImageElement = document.getElementById('questionImage');
        const questionTextElement = document.getElementById('questionText');
        const answersContainer = document.getElementById('answersContainer');
        const prevQuestionBtn = document.getElementById('prevQuestion');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const progressContainer = document.getElementById('progressContainer');
        
        const userScoreElement = document.getElementById('userScore');
        const opponentScoreElement = document.getElementById('opponentScore');
        const userResultName = document.getElementById('userResultName');
        const opponentResultName = document.getElementById('opponentResultName');
        const winnerText = document.getElementById('winnerText');

        function init() {
            totalQuestionsElement.textContent = questions.length;
            createProgressDots();
            
            createLobbyBtn.addEventListener('click', showCreateLobbyScreen);
            joinLobbyBtn.addEventListener('click', showJoinLobbyScreen);
            backToMenuBtn1.addEventListener('click', showMainMenu);
            backToMenuBtn2.addEventListener('click', showMainMenu);
            backToMenuBtn3.addEventListener('click', showMainMenu);

            joinLobbyConfirmBtn.addEventListener('click', joinLobby);
            

            startGameBtn.addEventListener('click', startExam);
            

            prevQuestionBtn.addEventListener('click', goToPreviousQuestion);
            nextQuestionBtn.addEventListener('click', goToNextQuestion);
            

            restartExamBtn.addEventListener('click', restartExam);

            generateLobbyCode();
        }


        function initPeer() {
            try {
                state.peer = new Peer(state.lobbyCode, {
                    debug: 3,
                    config: {
                        iceServers: [
                            { urls: 'stun:stun.l.google.com:19302' },
                            { urls: 'stun:global.stun.twilio.com:3478' }
                        ]
                    }
                });

                state.peer.on('open', (id) => {
                    console.log('Peer ID:', id);
                    state.peerId = id;
                    updateConnectionStatus(true);
                    
                    if (state.isHost) {
                        connectionStatus.textContent = '–õ–æ–±–±–∏ —Å–æ–∑–¥–∞–Ω–æ. –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...';
                    }
                });
                state.peer.on('connection', (conn) => {
                    state.conn = conn;
                    setupConnection(conn);
                });

                state.peer.on('error', (err) => {
                    console.error('Peer error:', err);
                    updateConnectionStatus(false);
                    
                    if (err.type === 'unavailable-id') {
                        generateLobbyCode();
                        setTimeout(() => initPeer(), 1000);
                    }
                });

                state.peer.on('disconnected', () => {
                    console.log('Peer disconnected');
                    updateConnectionStatus(false);
                });

            } catch (error) {
                console.error('Error initializing Peer:', error);
                updateConnectionStatus(false);
            }
        }


        function setupConnection(conn) {
            conn.on('open', () => {
                console.log('Connected to:', conn.peer);
                updateConnectionStatus(true);
                
                if (state.isHost) {

                    state.opponentName = conn.metadata.playerName;
                    player2Element.style.display = 'flex';
                    player2NameElement.textContent = state.opponentName;
                    connectionStatus.textContent = '–ò–≥—Ä–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω!';
                    waitingMessage.textContent = '–û–±–∞ –∏–≥—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã. –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —ç–∫–∑–∞–º–µ–Ω–∞...';
                    waitingMessage.className = 'status-message status-success';
                    startGameBtn.disabled = false;
                    

                    conn.send({
                        type: 'player_joined_confirm',
                        hostName: state.playerName
                    });
                }
            });

            conn.on('data', (data) => {
                handlePeerMessage(data);
            });

            conn.on('close', () => {
                console.log('Connection closed');
                handlePlayerDisconnected();
            });

            conn.on('error', (err) => {
                console.error('Connection error:', err);
            });
        }

        function connectToPeer(peerId) {
            try {
                const conn = state.peer.connect(peerId, {
                    metadata: {
                        playerName: state.playerName
                    },
                    reliable: true
                });
                
                state.conn = conn;
                setupConnection(conn);
                
                joinConnectionStatus.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ª–æ–±–±–∏...';
            } catch (error) {
                console.error('Error connecting to peer:', error);
                joinConnectionStatus.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ª–æ–±–±–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
            }
        }

        function handlePeerMessage(data) {
            switch (data.type) {
                case 'player_joined_confirm':
                    handlePlayerJoinedConfirm(data);
                    break;
                case 'start_game':
                    handleGameStarted();
                    break;
                case 'answer_selected':
                    handleOpponentAnswer(data);
                    break;
                case 'game_finished':
                    handleGameFinished(data);
                    break;
            }
        }

        function sendPeerMessage(message) {
            if (state.conn && state.conn.open) {
                state.conn.send(message);
            }
        }

        function updateConnectionStatus(connected) { const dots = [connectionDot, joinConnectionDot];
            const statuses = [connectionStatus, joinConnectionStatus];
            
            dots.forEach(dot => {
                if (connected) {
                    dot.classList.add('connected');
                } else {
                    dot.classList.remove('connected');
                }
            });
            
            if (state.isHost) {
                statuses[0].textContent = connected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
                statuses[0].style.color = connected ? '#2ecc71' : '#e74c3c';
            }
        }

        function showMainMenu() {
            hideAllScreens();
            screens.mainMenu.classList.add('active');
            resetConnectionState();
            if (state.peer) {
                state.peer.destroy();
                state.peer = null;
            }
        }

        function showCreateLobbyScreen() {
            hideAllScreens();
            screens.createLobby.classList.add('active');
            state.isHost = true;
            state.playerName = playerNameInput.value || '–ò–≥—Ä–æ–∫ 1';
            hostPlayerName.textContent = state.playerName + ' (–í—ã)';
            updatePlayerNames();
            

            initPeer();
        }

        function showJoinLobbyScreen() {
            hideAllScreens();
            screens.joinLobby.classList.add('active');
            state.isHost = false;
            state.playerName = joinPlayerNameInput.value || '–ò–≥—Ä–æ–∫ 2';
            updatePlayerNames();
            

            initPeer();
        }

        function hideAllScreens() {
            Object.values(screens).forEach(screen => {
                screen.classList.remove('active');
            });
        }

        function generateLobbyCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            state.lobbyCode = result;
            lobbyCodeDisplay.textContent = result;
        }

        function joinLobby() {
            const code = lobbyCodeInput.value.toUpperCase();
            
            if (!code) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ª–æ–±–±–∏');
                return;
            }
            
            if (code.length !== 6) {
                alert('–ö–æ–¥ –ª–æ–±–±–∏ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            state.lobbyCode = code;
            connectToPeer(code);
        }

        function handlePlayerJoinedConfirm(data) {
            if (!state.isHost) {

                state.opponentName = data.hostName;
                hideAllScreens();
                screens.createLobby.classList.add('active');
                connectionDot.classList.add('connected');
                connectionStatus.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –ª–æ–±–±–∏';
                connectionStatus.style.color = '#2ecc71';
                player2Element.style.display = 'flex';
                player2NameElement.textContent = state.playerName;
                hostPlayerName.textContent = state.opponentName + ' (–•–æ—Å—Ç)';
                waitingMessage.textContent = '–û–±–∞ –∏–≥—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã. –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —ç–∫–∑–∞–º–µ–Ω–∞...';
                waitingMessage.className = 'status-message status-success';
                startGameBtn.disabled = false;
            }
            
            updatePlayerNames();
        }

        function updatePlayerNames() {
            userResultName.textContent = state.playerName + ':';
            opponentResultName.textContent = (state.opponentName || '–°–æ–ø–µ—Ä–Ω–∏–∫') + ':';
        }

        function createProgressDots() {
            progressContainer.innerHTML = '';
            for (let i = 0; i < questions.length; i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                dot.dataset.index = i;
                dot.addEventListener('click', () => goToQuestion(i));
                progressContainer.appendChild(dot);
            }
        }

        function updateProgress() {
            const dots = progressContainer.querySelectorAll('.progress-dot');
            dots.forEach((dot, index) => {
                dot.classList.remove('current');
                
                if (state.userAnswers[index] !== null) {
                    dot.classList.add('answered');
                } else {
                    dot.classList.remove('answered');
                }
                
                if (index === state.currentQuestionIndex) {
                    dot.classList.add('current');
                }
            });
        }

        function startExam() {

            sendPeerMessage({
                type: 'start_game'
            });
            
            hideAllScreens();
            screens.exam.classList.add('active');
            state.examStarted = true;
            

            startTimer();
            

            showQuestion(state.currentQuestionIndex);
        }

        function handleGameStarted() {
            if (!state.isHost) {
                startExam();
            }
        }

        function startTimer() {
            updateTimerDisplay();
            
            state.timerInterval = setInterval(() => {
                state.timeLeft--;
                updateTimerDisplay();
                
                if (state.timeLeft <= 0) {
                    finishExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(state.timeLeft / 60);
            const seconds = state.timeLeft % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (state.timeLeft < 300) {
                timerElement.style.background = 'linear-gradient(135deg, #b21f1f, #fdbb2d)';
            }
        }

        function showQuestion(index) {
            const question = questions[index];
            
            currentQuestionElement.textContent = index + 1;
            questionTextElement.textContent = question.text;
            questionImageElement.src = question.image;
            questionImageElement.alt = `–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –∫ –≤–æ–ø—Ä–æ—Å—É ${index + 1}`;
            
            answersContainer.innerHTML = '';
            
            question.answers.forEach(answer => {
                const answerElement = document.createElement('div');
                answerElement.className = 'answer-option';
                if (state.userAnswers[index] === answer.id) {
                    answerElement.classList.add('selected');
                }
                
                answerElement.innerHTML = `
                    <span class="answer-letter">${answer.id.toUpperCase()}</span>
                    <span class="answer-text">${answer.text}</span>
                    ${state.opponentAnswers[index] === answer.id ? '<span class="friend-choice">–í—ã–±—Ä–∞–ª —Å–æ–ø–µ—Ä–Ω–∏–∫</span>' : ''}
                `;
                
                answerElement.addEventListener('click', () => selectAnswer(answer.id, index));
                answersContainer.appendChild(answerElement);
            });
            
            prevQuestionBtn.disabled = index === 0;
            nextQuestionBtn.textContent = index === questions.length - 1 ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ';
            
            updateProgress();
        }

        function selectAnswer(answerId, questionIndex = state.currentQuestionIndex) {
            state.userAnswers[questionIndex] = answerId;
            
            sendPeerMessage({
                type: 'answer_selected',
                questionIndex: questionIndex,
                answer: answerId
            });
            
            showQuestion(state.currentQuestionIndex);
        }

        function handleOpponentAnswer(data) {
            state.opponentAnswers[data.questionIndex] = data.answer;
            
            if (state.currentQuestionIndex === data.questionIndex) {
                showQuestion(state.currentQuestionIndex);
            }
            
            opponentStatusElement.textContent = '–û—Ç–≤–µ—Ç–∏–ª';
            setTimeout(() => {
                if (state.examStarted) {
                    opponentStatusElement.textContent = '–û—Ç–≤–µ—á–∞–µ—Ç...';
                }
            }, 2000);
        }

        function goToPreviousQuestion() {
            if (state.currentQuestionIndex > 0) {
                state.currentQuestionIndex--;
                showQuestion(state.currentQuestionIndex);
            }
        }

        function goToNextQuestion() {
            if (state.currentQuestionIndex < questions.length - 1) {
                state.currentQuestionIndex++;
                showQuestion(state.currentQuestionIndex);
            } else {
                finishExam();
            }
        }

        function goToQuestion(index) {
            state.currentQuestionIndex = index;
            showQuestion(state.currentQuestionIndex);
        }

        function finishExam() {
            clearInterval(state.timerInterval);
            hideAllScreens();
            screens.results.classList.add('active');
            
            const userScore = calculateScore(state.userAnswers);
            const opponentScore = calculateScore(state.opponentAnswers);
            
            userScoreElement.textContent = `${userScore}/${questions.length}`;
            opponentScoreElement.textContent = `${opponentScore}/${questions.length}`;
            
            if (userScore > opponentScore) {
                winnerText.textContent = `–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${state.playerName}!`;
                winnerText.style.color = '#27ae60';
            } else if (opponentScore > userScore) {
                winnerText.textContent = `–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${state.opponentName}!`;
                winnerText.style.color = '#27ae60';
            } else {
                winnerText.textContent = '–ù–∏—á—å—è!';
                winnerText.style.color = '#7f8c8d';
            }
            
            sendPeerMessage({
                type: 'game_finished',
                score: userScore
            });
        }

        function calculateScore(answers) {
            let score = 0;
            answers.forEach((answer, index) => {
                if (answer === questions[index].correctAnswer) {
                    score++;
                }
            });
            return score;
        }


        function handleGameFinished(data) {

        }


        function restartExam() {
            state.currentQuestionIndex = 0;
            state.userAnswers.fill(null);
            state.opponentAnswers.fill(null);
            state.timeLeft = 30 * 60;
            state.examStarted = false;
            
            hideAllScreens();
            screens.createLobby.classList.add('active');
            timerElement.style.background = 'linear-gradient(135deg, #1a2a6c, #2c3e50)';
            updateProgress();
        }

        function resetConnectionState() {
            connectionDot.classList.remove('connected');
            connectionStatus.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...';
            connectionStatus.style.color = '';
            joinConnectionDot.classList.remove('connected');
            joinConnectionStatus.textContent = '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
            joinConnectionStatus.style.color = '';
            player2Element.style.display = 'none';
            waitingMessage.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...';
            waitingMessage.className = 'status-message status-waiting';
            startGameBtn.disabled = true;
        }

        function handlePlayerDisconnected() {
            if (state.isHost) {
                player2Element.style.display = 'none';
                connectionStatus.textContent = '–ò–≥—Ä–æ–∫ –æ—Ç–∫–ª—é—á–∏–ª—Å—è. –û–∂–∏–¥–∞–Ω–∏–µ...';
                waitingMessage.textContent = '–ò–≥—Ä–æ–∫ –æ—Ç–∫–ª—é—á–∏–ª—Å—è. –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...';
                waitingMessage.className = 'status-message status-waiting';
                startGameBtn.disabled = true;
            } else {
                alert('–•–æ—Å—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è. –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.');
                showMainMenu();
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
